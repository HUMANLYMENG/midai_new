# Midai 项目进度记录

## 项目概述
Midai 是一个音乐收藏与发现平台，核心功能是交互式流派关系图谱。

## 当前进度（2026-02-10）

### ✅ 已完成的功能

#### 1. 核心功能
- **专辑管理**: 完整的 CRUD 操作
- **单曲管理**: 支持单曲/Track 的增删改查
- **CSV 批量导入**: 支持 UTF-8/GBK 编码，自动去重
- **封面自动获取**: 基于 Spotify 数据源，支持单张和批量获取

#### 2. 交互式流派图谱
- **力导向图可视化**: D3.js 实现，专辑与流派的动态关系网络
- **节点交互**: 拖拽节点、悬停高亮、点击查看详情
- **专辑节点聚合**: 点击专辑展开显示所属单曲（圆形布局）
- **图例筛选**: 点击图例高亮/取消高亮指定流派
- **缩放控制**: 鼠标滚轮 + 按钮缩放，自适应初始视图
- **边界约束**: 节点限制在画布范围内

#### 3. 侧边栏功能
- **Albums/Tracks 标签切换**: 在专辑和单曲列表间切换
- **搜索过滤**: 实时搜索专辑/单曲名称、艺术家、流派
- **排序**: 支持多种排序方式（默认、字母、流派、艺术家、厂牌、专辑）
- **首字母索引**: 按流派/艺术家/厂牌/字母排序时，显示右侧首字母定位滚动条，点击快速跳转
- **分组显示**: 按非默认排序时，列表按首字母分组显示粘性标题
- **右键菜单**: Focus / Edit / Delete / Fetch Cover 快捷操作

#### 4. 封面获取
- **批量获取**: 支持一键获取所有缺失封面（专辑+单曲）
- **实时进度**: SSE 实时推送处理进度，进度条动态更新
- **单张获取**: 右键菜单支持单个项目获取封面
- **Reload Cover**: 右下角按钮强制刷新所有封面

#### 5. UI/UX
- **双主题系统**: 深色 / 浅色 / 跟随系统
- **玻璃拟态设计**: 毛玻璃效果、柔和阴影
- **可拖拽弹窗**: 编辑窗口可自由拖动
- **流畅动画**: Framer Motion 驱动的页面过渡和交互

#### 6. 用户系统
- **NextAuth.js v5**: 支持 Google/Microsoft OAuth
- **默认用户**: 开发测试时自动使用默认用户

### 📊 数据库统计
- **专辑**: 45 张
- **单曲**: 492 首
- **总项目**: 537
- **流派**: 75 种（大量交错）

### 📝 待开发功能（Roadmap）

#### P1 - 体验优化
| 功能 | 状态 | 描述 |
|------|------|------|
| 悬浮信息卡片 | 📝 | 鼠标悬停显示专辑/单曲详情浮窗 |
| 键盘快捷键 | 📝 | Ctrl+N 新增、Delete 删除等 |
| 数据导出 | 📝 | 导出收藏到 CSV/JSON |

#### P2 - 功能扩展
| 功能 | 状态 | 描述 |
|------|------|------|
| 专辑详情页 | 📝 | 独立页面展示完整信息 |
| 自动抓取专辑歌曲 | 📝 | 从 Spotify 抓取专辑曲目 |
| 相似专辑推荐 | 📝 | 基于共同流派推荐 |
| 统计面板 | 📝 | 流派分布、收藏趋势图表 |

### 🐛 已知问题
- 无

### 💻 技术栈
- Next.js 15 + React 18
- TypeScript
- Prisma ORM + SQLite
- NextAuth.js v5 (Google/Microsoft OAuth)
- D3.js v7 (力导向图谱)
- Tailwind CSS
- Framer Motion

### 🗂️ 项目结构
```
app/
  ├── api/                    # API 路由
  ├── auth/signin/           # 登录页面
  ├── collection/            # 主页面（图谱+侧边栏）
  ├── globals.css            # 全局样式
  ├── layout.tsx             # 根布局
  └── page.tsx               # 首页

components/
  ├── album/                 # 专辑相关组件
  ├── collection/            # 收藏列表相关组件
  ├── graph/                 # 图谱相关组件
  └── ui/                    # UI 基础组件

lib/
  ├── auth.ts                # 认证工具
  ├── cover.ts               # 封面获取 (Spotify)
  ├── db.ts                  # Prisma 客户端
  ├── genres.ts              # 流派颜色映射
  ├── theme.ts               # 主题状态管理
  └── utils.ts               # 工具函数

prisma/
  ├── migrations/            # 数据库迁移
  └── schema.prisma          # 数据库模型

scripts/
  └── seed-data.ts           # 示例数据生成脚本

types/
  └── index.ts               # TypeScript 类型定义
```

---
*最后更新: 2026-02-10*
